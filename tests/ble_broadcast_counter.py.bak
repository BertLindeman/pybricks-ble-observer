# Best transfer if NO bluetooth connection is active to the computer

broadcast_interval = 250

from pybricks.hubs import ThisHub
from pybricks.tools import wait, StopWatch
from pybricks.parameters import Color 

hub = ThisHub(broadcast_channel=3)
watch = StopWatch()
print('ble_broadcast_counter')
# send a simple counter. The observer can start at any point and know what the next value should be.
counter = 1
while True:
    try:
        was = counter
        counter += 1
    except:
        counter = 1
    watch.reset()
    hub.ble.broadcast(counter)

    # Hub light will be RED if connected to a PC via bluetooth.
    # After disconnect (it takes a few seconds) the light goes to GREEN.
    if hub.system.info()['host_connected_ble']:
        hub.light.on(Color.RED)  # show RED if connected
    else:
        hub.light.on(Color.GREEN)
    
    wait(broadcast_interval - watch.time())
